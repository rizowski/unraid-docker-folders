Menu="Docker"
Title=""
Tag=""
Cond="is_file('/var/run/dockerd.pid')"
Markdown="false"
---
<?php
require_once '/usr/local/emhttp/plugins/unraid-docker-folders-modern/include/config.php';
require_once '/usr/local/emhttp/plugins/unraid-docker-folders-modern/classes/Database.php';

$db = Database::getInstance();
$row = $db->fetchOne('SELECT value FROM settings WHERE key = ?', ['replace_docker_section']);
$replaceDockersSection = ($row && $row['value'] === '1');

if (!$replaceDockersSection) return;
?>

<script>
(function() {
  function hideNativeDockerSection() {
    // Hide the "Docker Containers" title bar
    document.querySelectorAll('div.title').forEach(function(el) {
      if (el.textContent && /Docker Containers/i.test(el.textContent)) {
        el.style.display = 'none';
      }
    });

    // Hide the view mode toggle
    document.querySelectorAll('.ToggleViewMode').forEach(function(el) {
      el.style.display = 'none';
    });

    // Hide the container list itself
    var containerSection = null;
    var selectors = [
      '#docker_list',
      '#docker_containers',
      'table.docker_readmore',
      '#dockerContainerTable',
    ];
    for (var i = 0; i < selectors.length; i++) {
      containerSection = document.querySelector(selectors[i]);
      if (containerSection) break;
    }

    if (!containerSection) {
      var ctName = document.querySelector('.ct-name');
      if (ctName) {
        containerSection = ctName.closest('table') || ctName.closest('div');
      }
    }

    if (containerSection) {
      // Walk up to find the outermost single-child wrapper
      var target = containerSection;
      while (target.parentElement) {
        var parent = target.parentElement;
        if (parent === document.body || parent.id === 'content_all' || parent.id === 'tab1' ||
            parent.classList.contains('content') || parent.tagName === 'FORM') break;
        var siblings = Array.from(parent.childNodes).filter(function(n) {
          return n.nodeType === 1 || (n.nodeType === 3 && n.textContent.trim());
        });
        if (siblings.length === 1) {
          target = parent;
        } else {
          break;
        }
      }

      // Wrap native section in a collapsed accordion
      var accordion = document.createElement('details');
      accordion.className = 'native-docker-accordion';
      accordion.style.cssText = 'margin-top:12px;';

      var summary = document.createElement('summary');
      summary.style.cssText = 'cursor:pointer;padding:8px 12px;font-size:13px;user-select:none;';
      summary.textContent = 'Native Docker Containers';
      accordion.appendChild(summary);

      target.parentElement.insertBefore(accordion, target);
      accordion.appendChild(target);
    }

    return !!containerSection;
  }

  var attempts = 0;
  function tryHide() {
    if (!hideNativeDockerSection() && attempts < 20) {
      attempts++;
      setTimeout(tryHide, 250);
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', tryHide);
  } else {
    setTimeout(tryHide, 100);
  }
})();
</script>
