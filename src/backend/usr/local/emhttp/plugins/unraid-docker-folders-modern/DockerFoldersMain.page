Menu="Docker:0"
Title="Folders"
Tag="folder-open"
Cond="is_file('/var/run/dockerd.pid')"
Markdown="false"
---
<?php
require_once '/usr/local/emhttp/plugins/unraid-docker-folders-modern/include/config.php';

$dbStatus = file_exists(DB_PATH) ? 'exists' : 'missing';
?>

<?php if ($dbStatus === 'missing'): ?>
<div style="background:#f0f0f0;padding:20px;margin:20px;border:2px solid #f44336;border-radius:8px;">
    <h3>Database Not Found</h3>
    <p>The plugin database has not been initialized. Please reinstall the plugin or run migrations.</p>
    <p>Expected path: <code><?= DB_PATH ?></code></p>
</div>
<?php else: ?>
<iframe id="docker-folders-frame"
        style="width:100%;min-height:600px;border:none;"
        scrolling="no"
        allowfullscreen></iframe>
<script>
(function() {
  var frame = document.getElementById('docker-folders-frame');
  var token = (typeof csrf_token === 'string') ? csrf_token : '';

  // Read Unraid CSS variables from parent document so the iframe can match the theme
  var vars = [
    '--text-color', '--background-color', '--border-color',
    '--header-background', '--header-text-color',
    '--button-background', '--button-hover', '--button-text-color',
    '--input-background', '--input-border'
  ];
  var cs = getComputedStyle(document.documentElement);
  var theme = {};
  vars.forEach(function(v) {
    var val = cs.getPropertyValue(v).trim();
    if (val) theme[v] = val;
  });
  var themeParam = Object.keys(theme).length > 0
    ? '&theme=' + encodeURIComponent(JSON.stringify(theme))
    : '';

  frame.src = '/plugins/unraid-docker-folders-modern/assets/index.html?csrf_token=' + encodeURIComponent(token) + themeParam;
  window.addEventListener('message', function(e) {
    if (e.data && e.data.type === 'docker-folders-resize') {
      frame.style.height = e.data.height + 'px';
    }
  });
})();
</script>
<?php endif; ?>
